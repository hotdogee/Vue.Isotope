"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function addClassToVNode(e,t){if((0,_vue.isVNode)(e)){var u=e.props?_extends({},e.props):{},n=u["class"]||"";Array.isArray(n)?n=n.join(" "):"object"===("undefined"==typeof n?"undefined":_typeof(n))&&(n=Object.keys(n).filter(function(e){return n[e]}).join(" ")),n.indexOf(t)===-1&&(u["class"]=(n+" "+t).trim()),e.props=u}}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var u=arguments[t];for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n])}return e},_vue=require("vue"),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),_isotopeLayout=require("isotope-layout"),_isotopeLayout2=_interopRequireDefault(_isotopeLayout);exports["default"]=(0,_vue.defineComponent)({name:"isotope",props:{options:{type:Object,"default":function(){return{layoutMode:"masonry",masonry:{gutter:10}}}},itemSelector:{type:String,"default":"item"},list:{type:Array,required:!0,"default":function(){return[]}}},emits:["sort","filter","layout","arrange","shuffle"],setup:function(e,t){function u(){v.clear();var t=l["default"]?l["default"]():[];t.forEach(function(t,u){t&&t.el&&v.set(t.el,{vm:e.list[u],index:u})})}function n(){s.value.forEach(function(e){return e()}),s.value=[],p.value&&(p.value(),p.value=null)}function a(){n();var t=y.value.getSortData;if(t){var u=[];_lodash2["default"].forEach(t,function(t,n){_lodash2["default"].isFunction(t)?e.list.forEach(function(e,n){var a={vm:e,index:n},r=(0,_vue.watch)(function(){return t(a)},function(){f.value&&(f.value.updateSortData(),o())});u.push(r)}):_lodash2["default"].isString(t)&&e.list.forEach(function(e,n){var a=(0,_vue.watch)(function(){return _lodash2["default"].get(e,t)},function(){f.value&&(f.value.updateSortData(),o())});u.push(a)})}),s.value=u}}function r(t){if(!y.value||!y.value.getFilterData||!y.value.getFilterData[t])return console.warn("Filter function '"+t+"' not found in options.getFilterData"),function(){return!0};var u=y.value.getFilterData[t];return p.value&&p.value(),p.value=(0,_vue.watch)(function(){return e.list.map(function(e,t){return u(v.get(e))})},function(){o()},{deep:!0}),function(e){return u(e)}}function o(){f.value&&!g&&(g=!0,(0,_vue.nextTick)(function(){f.value&&f.value.arrange(),g=!1}))}var l=(t.emit,t.slots),i=((0,_vue.getCurrentInstance)(),(0,_vue.ref)(null)),f=(0,_vue.ref)(null),v=new Map,c=(0,_vue.ref)([]),d=(0,_vue.ref)(new Set),s=(0,_vue.ref)([]),p=(0,_vue.ref)(null),_=(0,_vue.ref)([]),y=(0,_vue.computed)(function(){var t=_lodash2["default"].merge({},e.options,{itemSelector:"."+e.itemSelector});return t.getSortData&&_lodash2["default"].forOwn(t.getSortData,function(e,u){_lodash2["default"].isString(e)?t.getSortData[u]=function(t){var u=v.get(t);return u?u.vm[e]:void 0}:_lodash2["default"].isFunction(e)&&(t.getSortData[u]=function(t){var u=v.get(t);return u?e(u.vm,u.index):void 0})}),t.getFilterData&&_lodash2["default"].forOwn(t.getFilterData,function(e,u){_lodash2["default"].isFunction(e)&&(t.getFilterData[u]=function(t){var u=v.get(t);return u?e(u.vm,u.index):void 0})}),t}),h=(0,_vue.ref)({}),g=!1;(0,_vue.onMounted)(function(){i.value&&(h.value=_lodash2["default"].cloneDeep(y.value),h.value.filter&&_lodash2["default"].isString(h.value.filter)&&h.value.getFilterData?h.value.filter=r(h.value.filter):"*"===h.value.filter||(h.value.filter="*"),(0,_vue.nextTick)(function(){u(),f.value=new _isotopeLayout2["default"](i.value,h.value),a()}))}),(0,_vue.onBeforeUpdate)(function(){i.value&&(_.value=Array.from(i.value.children));var e=new Set,t=l["default"]?l["default"]():[];t.forEach(function(t){t&&null!=t.key&&e.add(t.key)});var u=new Set(c.value.map(function(e){return e.key}));d.value.clear(),u.forEach(function(t){e.has(t)||d.value.add(t)}),c.value=t.filter(function(e){return e&&null!=e.key}),n()}),(0,_vue.onUpdated)(function(){if(f.value&&i.value){var e=Array.from(i.value.children),t=e.filter(function(e){return!(_.value.indexOf(e)!==-1)}),n=_.value.filter(function(t){return!(e.indexOf(t)!==-1)});u(),n.length>0&&(f.value.remove(n),n.forEach(function(e){return v["delete"](e)})),t.length>0&&f.value.insert(t),(n.length>0||t.length>0)&&o(),a(),_.value=[]}}),(0,_vue.onBeforeUnmount)(function(){n(),f.value&&(f.value.destroy(),f.value=null),v.clear()});var m=function(){var t=l["default"]?l["default"]():[],u=[];return t.forEach(function(t,n){if(t&&t.type)if(null==t.key)console.warn("Isotope children must be keyed. Child at index "+n+" is missing a key."),u.push(t);else{var a=(0,_vue.cloneVNode)(t);addClassToVNode(a,e.itemSelector),u.push(a)}}),(0,_vue.h)("div",{ref:i},u)};return m}});