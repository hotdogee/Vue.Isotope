Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_lodash=_interopRequireDefault(require("lodash")),_isotopeLayout=_interopRequireDefault(require("isotope-layout"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function addClassToVNode(e,t){var r,n;(0,_vue.isVNode)(e)&&(r=e.props?_objectSpread({},e.props):{},n=r.class||"",Array.isArray(n)?n=n.join(" "):"object"===_typeof(n)&&(n=Object.keys(n).filter(function(e){return n[e]}).join(" ")),-1===n.indexOf(t)&&(r.class=(n+" "+t).trim()),e.props=r)}var _default2=exports.default=(0,_vue.defineComponent)({name:"isotope",props:{options:{type:Object,default:function(){return{layoutMode:"masonry",masonry:{gutter:10}}}},itemSelector:{type:String,default:"item"},list:{type:Array,required:!0,default:function(){return[]}}},emits:["sort","filter","layout","arrange","shuffle"],setup:function(o,e){e.emit;var n=e.slots,u=((0,_vue.getCurrentInstance)(),(0,_vue.ref)(null)),a=(0,_vue.ref)(null),l=new Map,i=(0,_vue.ref)([]),f=(0,_vue.ref)(new Set),t=(0,_vue.ref)([]),c=(0,_vue.ref)(null),v=(0,_vue.ref)([]),s=(0,_vue.computed)(function(){var r=_lodash.default.merge({},o.options,{itemSelector:".".concat(o.itemSelector)});return r.getSortData&&_lodash.default.forOwn(r.getSortData,function(t,e){_lodash.default.isString(t)?r.getSortData[e]=function(e){e=l.get(e);return e?e.vm[t]:void 0}:_lodash.default.isFunction(t)&&(r.getSortData[e]=function(e){e=l.get(e);return e?t(e.vm,e.index):void 0})}),r.getFilterData&&_lodash.default.forOwn(r.getFilterData,function(t,e){_lodash.default.isFunction(t)&&(r.getFilterData[e]=function(e){e=l.get(e);return e?t(e.vm,e.index):void 0})}),r}),r=(0,_vue.ref)({});function d(){l.clear(),(n.default?n.default():[]).forEach(function(e,t){e&&e.el&&l.set(e.el,{vm:o.list[t],index:t})})}function p(){t.value.forEach(function(e){return e()}),t.value=[],c.value&&(c.value(),c.value=null)}function y(){p();var u,e=s.value.getSortData;e&&(u=[],_lodash.default.forEach(e,function(n,e){_lodash.default.isFunction(n)?o.list.forEach(function(e,t){var r={vm:e,index:t},e=(0,_vue.watch)(function(){return n(r)},function(){a.value&&(a.value.updateSortData(),h())});u.push(e)}):_lodash.default.isString(n)&&o.list.forEach(function(e,t){var r=(0,_vue.watch)(function(){return _lodash.default.get(e,n)},function(){a.value&&(a.value.updateSortData(),h())});u.push(r)})}),t.value=u)}function _(e){var r;return s.value&&s.value.getFilterData&&s.value.getFilterData[e]?(r=s.value.getFilterData[e],c.value&&c.value(),c.value=(0,_vue.watch)(function(){return o.list.map(function(e,t){return r(l.get(e))})},function(){h()},{deep:!0}),function(e){return r(e)}):(console.warn("Filter function '".concat(e,"' not found in options.getFilterData")),function(){return!0})}var m=!1;function h(){a.value&&!m&&(m=!0,(0,_vue.nextTick)(function(){a.value&&a.value.arrange(),m=!1}))}(0,_vue.onMounted)(function(){u.value&&(r.value=_lodash.default.cloneDeep(s.value),r.value.filter&&_lodash.default.isString(r.value.filter)&&r.value.getFilterData?r.value.filter=_(r.value.filter):"*"!==r.value.filter&&(r.value.filter="*"),(0,_vue.nextTick)(function(){d(),a.value=new _isotopeLayout.default(u.value,r.value),y()}))}),(0,_vue.onBeforeUpdate)(function(){u.value&&(v.value=Array.from(u.value.children));var t=new Set,e=n.default?n.default():[],r=(e.forEach(function(e){e&&null!=e.key&&t.add(e.key)}),new Set(i.value.map(function(e){return e.key})));f.value.clear(),r.forEach(function(e){t.has(e)||f.value.add(e)}),i.value=e.filter(function(e){return e&&null!=e.key}),p()}),(0,_vue.onUpdated)(function(){var t,e,r;a.value&&u.value&&(e=(t=Array.from(u.value.children)).filter(function(e){return!(-1!==v.value.indexOf(e))}),r=v.value.filter(function(e){return!(-1!==t.indexOf(e))}),d(),0<r.length&&(a.value.remove(r),r.forEach(function(e){return l.delete(e)})),0<e.length&&a.value.insert(e),(0<r.length||0<e.length)&&h(),y(),v.value=[])}),(0,_vue.onBeforeUnmount)(function(){p(),a.value&&(a.value.destroy(),a.value=null),l.clear()});return function(){var e=n.default?n.default():[],r=[];return e.forEach(function(e,t){e&&e.type&&(null==e.key?(console.warn("Isotope children must be keyed. Child at index ".concat(t," is missing a key.")),r.push(e)):(addClassToVNode(t=(0,_vue.cloneVNode)(e),o.itemSelector),r.push(t)))}),(0,_vue.h)("div",{ref:u},r)}}});